#!/usr/bin/env python

import sys
import subprocess
import tempfile
import os

"""Wrapper for the threeWay executable"""

###########################################
## Input 
###########################################

def connectionNames(connection):
	return map(str, connection)

def groupString(connection):
	return "\t".join(connectionNames(connection)) + "\n"

def write3WayGroupInput(connection, file):
	file.write(groupString(connection))

def write3WayInput(connections, filename):
	"""Writes file to be read by threeWay"""
	file = open(filename, "w")
	for connection in connections:
		write3WayGroupInput(connection, file)
	file.close()
			
###########################################
## Output 
###########################################

def parse3WayOutputLine(line):
	return map(int, line.strip().split())

def parse3WayOutput(filename):
	"""Reads the output of threeWay"""
	file = open(filename)
	result = [parse3WayOutputLine(line) for line in file]
	file.close()
	os.remove(filename)
	return result

###########################################
## Master function
###########################################

def compute(connections):
	"""Wrapper to the threeWay executable, which detects three wat connected components in linear time"""
	file1, input = tempfile.mkstemp(dir='.')
	file2, output = tempfile.mkstemp(dir='.')

	write3WayInput(connections, input)
	print "Running " + " ".join(['3way', input, output])
	if subprocess.Popen(['3way', input, output], stdout=sys.stdout, stderr=subprocess.STDOUT).wait() != 0:
	    sys.exit("3way did not complete")
	print "Done"
	os.remove(input)
	
	return parse3WayOutput(output)

###########################################
## Unit test
###########################################

def main():
	pass

if __name__ == "__main__":
	main()
